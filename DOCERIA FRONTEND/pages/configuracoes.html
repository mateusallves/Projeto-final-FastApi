<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurações - Doce Encanto</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="pages.css">
</head>
<body>
    <!-- TOP BAR -->
    <div class="top-bar">
        <div class="container">
            <span><i class="fas fa-clock"></i> Segunda a Sexta: 10h às 18h</span>
            <span><i class="fas fa-phone"></i> (35) 3421-5678 | <i class="fab fa-whatsapp"></i> (35) 99876-5432</span>
        </div>
    </div>

    <!-- HEADER -->
    <header class="header">
        <div class="container header-content">
            <a href="../index.html" class="logo">Doce <span>Encanto</span></a>
            <nav class="nav-menu" id="navMenu">
                <a href="../index.html">INÍCIO</a>
                <a href="doceria.html">DOCERIA</a>
                <a href="kit-festa.html">KIT FESTA</a>
                <a href="sobre.html">SOBRE</a>
                <a href="contato.html">CONTATO</a>
            </nav>
            <div class="header-actions">
                <a href="minha-conta.html" class="account-btn account-btn--logged">
                    <i class="fas fa-user-check"></i>
                    <span id="userName">Minha Conta</span>
                </a>
                <a href="carrinho.html" class="cart-btn">
                    <i class="fas fa-shopping-bag"></i>
                    <span class="cart-count" id="cartCount">0</span>
                </a>
                <button class="mobile-menu-btn" id="mobileMenuBtn"><i class="fas fa-bars"></i></button>
            </div>
        </div>
    </header>

    <!-- PAGE HEADER -->
    <section class="page-header">
        <div class="container">
            <h1><i class="fas fa-cog"></i> Configurações</h1>
            <div class="breadcrumb">
                <a href="../index.html">Início</a>
                <i class="fas fa-chevron-right"></i>
                <a href="minha-conta.html">Minha Conta</a>
                <i class="fas fa-chevron-right"></i>
                <span>Configurações</span>
            </div>
        </div>
    </section>

    <!-- SETTINGS SECTION -->
    <section class="settings-section">
        <div class="container">
            <div class="settings-layout">
                <aside class="settings-sidebar">
                    <nav class="settings-menu">
                        <a href="#dados-pessoais" class="settings-menu-item active" onclick="showSection('dados-pessoais')">
                            <i class="fas fa-user"></i> Dados Pessoais
                        </a>
                        <a href="#endereco" class="settings-menu-item" onclick="showSection('endereco')">
                            <i class="fas fa-map-marker-alt"></i> Endereço
                        </a>
                        <a href="#senha" class="settings-menu-item" onclick="showSection('senha')">
                            <i class="fas fa-lock"></i> Alterar Senha
                        </a>
                        <a href="#notificacoes" class="settings-menu-item" onclick="showSection('notificacoes')">
                            <i class="fas fa-bell"></i> Notificações
                        </a>
                    </nav>
                </aside>

                <main class="settings-content">
                    <!-- Dados Pessoais -->
                    <div id="dados-pessoais" class="settings-section-content active">
                        <h2>Dados Pessoais</h2>
                        <form id="personalDataForm" onsubmit="savePersonalData(event)">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nome Completo</label>
                                    <input type="text" id="nome" required>
                                </div>
                                <div class="form-group">
                                    <label>E-mail</label>
                                    <input type="email" id="email" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Telefone</label>
                                    <input type="tel" id="telefone" placeholder="(11) 99999-9999">
                                </div>
                                <div class="form-group">
                                    <label>CPF</label>
                                    <input type="text" id="cpf" placeholder="000.000.000-00">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Data de Nascimento</label>
                                    <input type="date" id="dataNascimento">
                                </div>
                            </div>
                            <button type="submit" class="btn-primary">
                                <i class="fas fa-save"></i> Salvar Alterações
                            </button>
                        </form>
                    </div>

                    <!-- Endereço -->
                    <div id="endereco" class="settings-section-content">
                        <h2>Endereço</h2>
                        <form id="addressForm" onsubmit="saveAddress(event)">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>CEP</label>
                                    <input type="text" id="cepAddress" placeholder="00000-000" maxlength="9">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group" style="flex: 2;">
                                    <label>Endereço</label>
                                    <input type="text" id="enderecoAddress" placeholder="Rua, Avenida...">
                                </div>
                                <div class="form-group">
                                    <label>Número</label>
                                    <input type="text" id="numeroAddress" placeholder="123">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Complemento</label>
                                    <input type="text" id="complementoAddress" placeholder="Apto, Bloco...">
                                </div>
                                <div class="form-group">
                                    <label>Bairro</label>
                                    <input type="text" id="bairroAddress" placeholder="Bairro">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Cidade</label>
                                    <input type="text" id="cidadeAddress" placeholder="Cidade">
                                </div>
                                <div class="form-group">
                                    <label>Estado</label>
                                    <select id="estadoAddress">
                                        <option value="">Selecione</option>
                                        <option value="SP">São Paulo</option>
                                        <option value="RJ">Rio de Janeiro</option>
                                        <option value="MG">Minas Gerais</option>
                                        <option value="ES">Espírito Santo</option>
                                    </select>
                                </div>
                            </div>
                            <button type="submit" class="btn-primary">
                                <i class="fas fa-save"></i> Salvar Endereço
                            </button>
                        </form>
                    </div>

                    <!-- Senha -->
                    <div id="senha" class="settings-section-content">
                        <h2>Alterar Senha</h2>
                        <form id="passwordForm" onsubmit="changePassword(event)">
                            <div class="form-group">
                                <label>Senha Atual</label>
                                <input type="password" id="senhaAtual" required>
                            </div>
                            <div class="form-group">
                                <label>Nova Senha</label>
                                <input type="password" id="novaSenha" required minlength="6">
                            </div>
                            <div class="form-group">
                                <label>Confirmar Nova Senha</label>
                                <input type="password" id="confirmarSenha" required minlength="6">
                            </div>
                            <button type="submit" class="btn-primary">
                                <i class="fas fa-key"></i> Alterar Senha
                            </button>
                        </form>
                    </div>

                    <!-- Notificações -->
                    <div id="notificacoes" class="settings-section-content">
                        <h2>Notificações</h2>
                        <form id="notificationsForm" onsubmit="saveNotifications(event)">
                            <div class="checkbox-group">
                                <label class="checkbox">
                                    <input type="checkbox" id="notifEmail">
                                    <span>Receber notificações por e-mail</span>
                                </label>
                                <label class="checkbox">
                                    <input type="checkbox" id="notifSMS">
                                    <span>Receber notificações por SMS</span>
                                </label>
                                <label class="checkbox">
                                    <input type="checkbox" id="notifPedidos">
                                    <span>Notificar sobre status dos pedidos</span>
                                </label>
                                <label class="checkbox">
                                    <input type="checkbox" id="notifPromocoes">
                                    <span>Receber ofertas e promoções</span>
                                </label>
                            </div>
                            <button type="submit" class="btn-primary">
                                <i class="fas fa-save"></i> Salvar Preferências
                            </button>
                        </form>
                    </div>
                </main>
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col footer-about">
                    <h3 class="logo">Doce <span>Encanto</span></h3>
                    <p>Doces artesanais feitos com amor.</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Delicious Doceria</p>
            </div>
        </div>
    </footer>

    <script src="../js/api.js"></script>
    <script src="../js/cart.js"></script>
    <script src="../js/main.js"></script>
    <script src="../js/account.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Verificar autenticação
            if (!API.Auth.isAuthenticated()) {
                window.location.href = 'login.html?next=' + encodeURIComponent(window.location.pathname);
                return;
            }

            // Carregar dados do cliente
            loadClienteData();
        });

        function showSection(sectionId) {
            // Esconder todas as seções
            document.querySelectorAll('.settings-section-content').forEach(section => {
                section.classList.remove('active');
            });

            // Remover active de todos os itens do menu
            document.querySelectorAll('.settings-menu-item').forEach(item => {
                item.classList.remove('active');
            });

            // Mostrar seção selecionada
            document.getElementById(sectionId).classList.add('active');
            document.querySelector(`[href="#${sectionId}"]`).classList.add('active');
        }

        async function loadClienteData() {
            try {
                const user = API.Auth.getUser();
                const cliente = await Account.getOrCreateCliente(user);

                // Preencher formulário de dados pessoais
                document.getElementById('nome').value = cliente.nome || '';
                document.getElementById('email').value = cliente.email || '';
                document.getElementById('telefone').value = cliente.telefone || '';
                document.getElementById('cpf').value = cliente.cpf || '';
                document.getElementById('dataNascimento').value = cliente.data_nascimento || '';

                // Preencher formulário de endereço
                document.getElementById('cepAddress').value = cliente.cep || '';
                document.getElementById('enderecoAddress').value = cliente.endereco || '';
                document.getElementById('numeroAddress').value = cliente.numero || '';
                document.getElementById('complementoAddress').value = cliente.complemento || '';
                document.getElementById('bairroAddress').value = cliente.bairro || '';
                document.getElementById('cidadeAddress').value = cliente.cidade || '';
                document.getElementById('estadoAddress').value = cliente.estado || '';
            } catch (error) {
                console.error('Erro ao carregar dados do cliente:', error);
            }
        }

        async function savePersonalData(event) {
            event.preventDefault();
            try {
                const user = API.Auth.getUser();
                const cliente = await Account.getOrCreateCliente(user);

                const data = {
                    nome: document.getElementById('nome').value,
                    email: document.getElementById('email').value,
                    telefone: document.getElementById('telefone').value,
                    cpf: document.getElementById('cpf').value,
                    data_nascimento: document.getElementById('dataNascimento').value || null
                };

                await API.Clientes.atualizar(cliente.id, data);
                alert('Dados pessoais atualizados com sucesso!');
            } catch (error) {
                alert('Erro ao salvar dados: ' + error.message);
            }
        }

        async function saveAddress(event) {
            event.preventDefault();
            try {
                const user = API.Auth.getUser();
                const cliente = await Account.getOrCreateCliente(user);

                const data = {
                    cep: document.getElementById('cepAddress').value.replace(/\D/g, ''),
                    endereco: document.getElementById('enderecoAddress').value,
                    numero: document.getElementById('numeroAddress').value,
                    complemento: document.getElementById('complementoAddress').value,
                    bairro: document.getElementById('bairroAddress').value,
                    cidade: document.getElementById('cidadeAddress').value,
                    estado: document.getElementById('estadoAddress').value
                };

                await API.Clientes.atualizar(cliente.id, data);
                alert('Endereço atualizado com sucesso!');
            } catch (error) {
                alert('Erro ao salvar endereço: ' + error.message);
            }
        }

        async function changePassword(event) {
            event.preventDefault();
            const senhaAtual = document.getElementById('senhaAtual').value;
            const novaSenha = document.getElementById('novaSenha').value;
            const confirmarSenha = document.getElementById('confirmarSenha').value;

            if (!senhaAtual || !novaSenha || !confirmarSenha) {
                alert('Preencha todos os campos!');
                return;
            }

            if (novaSenha !== confirmarSenha) {
                alert('As senhas não conferem!');
                return;
            }

            if (novaSenha.length < 6) {
                alert('A nova senha deve ter pelo menos 6 caracteres!');
                return;
            }

            try {
                await API.Auth.changePassword(senhaAtual, novaSenha);
                alert('Senha alterada com sucesso!');
                document.getElementById('passwordForm').reset();
            } catch (error) {
                alert('Erro ao alterar senha: ' + error.message);
            }
        }

        function saveNotifications(event) {
            event.preventDefault();
            // TODO: Implementar salvamento de preferências de notificação
            alert('Preferências de notificação salvas!');
        }
    </script>
</body>
</html>

