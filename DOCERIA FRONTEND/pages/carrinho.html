<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrinho - Doce Encanto</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="pages.css">
</head>
<body>
    <!-- TOP BAR -->
    <div class="top-bar">
        <div class="container">
            <span><i class="fas fa-clock"></i> Segunda a Sexta: 10h às 18h</span>
            <span><i class="fas fa-phone"></i> (35) 3421-5678 | <i class="fab fa-whatsapp"></i> (35) 99876-5432</span>
        </div>
    </div>

    <!-- HEADER -->
    <header class="header">
        <div class="container header-content">
            <a href="../index.html" class="logo">Doce <span>Encanto</span></a>
            <nav class="nav-menu" id="navMenu">
                <a href="../index.html">INÍCIO</a>
                <a href="doceria.html">DOCERIA</a>
                <a href="kit-festa.html">KIT FESTA</a>
                <a href="sobre.html">SOBRE</a>
                <a href="contato.html">CONTATO</a>
            </nav>
            <div class="header-actions">
                <a href="login.html" class="account-btn"><i class="fas fa-user"></i><span>Entrar</span></a>
                <a href="carrinho.html" class="cart-btn active">
                    <i class="fas fa-shopping-bag"></i>
                    <span class="cart-count" id="cartCount">0</span>
                </a>
                <button class="mobile-menu-btn" id="mobileMenuBtn"><i class="fas fa-bars"></i></button>
            </div>
        </div>
    </header>

    <!-- PAGE HEADER -->
    <section class="page-header">
        <div class="container">
            <h1><i class="fas fa-shopping-cart"></i> Meu Carrinho</h1>
            <div class="breadcrumb">
                <a href="../index.html">Início</a>
                <i class="fas fa-chevron-right"></i>
                <span>Carrinho</span>
            </div>
        </div>
    </section>

    <!-- CART CONTENT -->
    <section class="cart-section">
        <div class="container">
            <!-- Empty Cart -->
            <div class="empty-cart" id="emptyCart">
                <i class="fas fa-shopping-bag"></i>
                <h2>Seu carrinho está vazio</h2>
                <p>Adicione deliciosos produtos para continuar</p>
                <a href="doceria.html" class="btn-secondary">Ver Produtos</a>
            </div>

            <!-- Cart with items -->
            <div class="cart-content" id="cartContent" style="display: none;">
                <div class="cart-items">
                    <div class="cart-header-row">
                        <span>Produto</span>
                        <span>Quantidade</span>
                        <span>Preço</span>
                        <span>Subtotal</span>
                        <span></span>
                    </div>
                    <div id="cartItems">
                        <!-- Items loaded dynamically -->
                    </div>
                </div>

                <div class="cart-summary">
                    <h3>Resumo do Pedido</h3>
                    
                    <div class="summary-row">
                        <span>Subtotal</span>
                        <span id="subtotal">R$ 0,00</span>
                    </div>
                    
                    <div class="summary-row">
                        <span>Taxa de entrega</span>
                        <span id="deliveryFee">A calcular</span>
                    </div>

                    <div class="coupon-box">
                        <input type="text" id="couponInput" placeholder="Cupom de desconto">
                        <button onclick="applyCoupon()">Aplicar</button>
                    </div>

                    <div class="summary-row discount" id="discountRow" style="display: none;">
                        <span>Desconto</span>
                        <span id="discount">- R$ 0,00</span>
                    </div>

                    <div class="summary-row total">
                        <span>Total</span>
                        <span id="total">R$ 0,00</span>
                    </div>

                    <a href="checkout.html" class="btn-checkout" data-requires-auth>
                        <i class="fas fa-lock"></i> Finalizar Compra
                    </a>

                    <a href="doceria.html" class="btn-continue">
                        <i class="fas fa-arrow-left"></i> Continuar Comprando
                    </a>

                    <div class="payment-info">
                        <p><i class="fas fa-shield-alt"></i> Pagamento 100% seguro</p>
                        <div class="payment-icons">
                            <i class="fab fa-cc-visa"></i>
                            <i class="fab fa-cc-mastercard"></i>
                            <i class="fab fa-pix"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col footer-about">
                    <h3 class="logo">Doce <span>Encanto</span></h3>
                    <p>Doces artesanais feitos com amor.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h4>Contato</h4>
                    <ul class="contact-info">
                        <li><i class="fas fa-phone"></i><span>(35) 3421-5678</span></li>
                        <li><i class="fab fa-whatsapp"></i><span>(35) 99876-5432</span></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Delicious Doceria</p>
            </div>
        </div>
    </footer>

    <a href="https://wa.me/5535998765432" class="whatsapp-float" target="_blank">
        <i class="fab fa-whatsapp"></i>
    </a>

    <script src="../js/api.js"></script>
    <script src="../js/cart.js"></script>
    <script src="../js/main.js"></script>
    <script>
        const DELIVERY_FEE = 15.00;
        let appliedDiscount = 0;

        document.addEventListener('DOMContentLoaded', () => {
            renderCart();
            window.addEventListener('cartUpdated', renderCart);
        });

        function renderCart() {
            const items = Cart.getItems();
            const emptyCart = document.getElementById('emptyCart');
            const cartContent = document.getElementById('cartContent');
            const cartItemsEl = document.getElementById('cartItems');

            if (items.length === 0) {
                emptyCart.style.display = 'flex';
                cartContent.style.display = 'none';
                return;
            }

            emptyCart.style.display = 'none';
            cartContent.style.display = 'grid';

            cartItemsEl.innerHTML = items.map(item => {
                const productForIcon = { nome: item.name || '' };
                const icon = getProductIcon(productForIcon);
                return `
                <div class="cart-item">
                    <div class="item-info">
                        <div class="item-image">
                            <i class="fas ${icon}"></i>
                        </div>
                        <div class="item-details">
                            <h4>${item.name}</h4>
                            <p>${item.description || ''}</p>
                        </div>
                    </div>
                    <div class="item-quantity">
                        <button onclick="updateQty(${item.id}, '${item.type}', ${item.quantity - 1})">
                            <i class="fas fa-minus"></i>
                        </button>
                        <span>${item.quantity}</span>
                        <button onclick="updateQty(${item.id}, '${item.type}', ${item.quantity + 1})">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div class="item-price">
                        R$ ${item.price.toFixed(2).replace('.', ',')}
                    </div>
                    <div class="item-subtotal">
                        R$ ${(item.price * item.quantity).toFixed(2).replace('.', ',')}
                    </div>
                    <button class="remove-btn" onclick="removeItem(${item.id}, '${item.type}')">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            }).join('');

            updateTotals();
        }

        function updateQty(id, type, qty) {
            Cart.updateQuantity(id, type, qty);
            renderCart();
        }

        function removeItem(id, type) {
            Cart.removeItem(id, type);
            renderCart();
        }

        function updateTotals() {
            const subtotal = Cart.getTotal();
            const delivery = subtotal > 0 ? DELIVERY_FEE : 0;
            const total = subtotal + delivery - appliedDiscount;

            document.getElementById('subtotal').textContent = `R$ ${subtotal.toFixed(2).replace('.', ',')}`;
            document.getElementById('deliveryFee').textContent = `R$ ${delivery.toFixed(2).replace('.', ',')}`;
            document.getElementById('total').textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;
        }

        function applyCoupon() {
            const coupon = document.getElementById('couponInput').value.toUpperCase();
            
            if (coupon === 'DOCEENCANTO10') {
                const subtotal = Cart.getTotal();
                appliedDiscount = subtotal * 0.10;
                
                document.getElementById('discountRow').style.display = 'flex';
                document.getElementById('discount').textContent = `- R$ ${appliedDiscount.toFixed(2).replace('.', ',')}`;
                
                updateTotals();
                alert('Cupom aplicado com sucesso! 10% de desconto.');
            } else {
                alert('Cupom inválido');
            }
        }
    </script>
</body>
</html>

